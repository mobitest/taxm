<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Grid Listview - jQuery Mobile Demos</title>
	<link rel="stylesheet"  href="../demos/css/themes/default/jquery.mobile-1.3.1.min.css">
	<link rel="stylesheet" href="../demos/_assets/css/jqm-demos.css">
	<link rel="shortcut icon" href="../demos/favicon.ico">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,700">
	<link rel="stylesheet" href="t1-welcome.css">
	<script src="../demos/js/jquery.js"></script>
	<script src="../demos/_assets/js/index.js"></script>
	<script src="../demos/js/jquery.mobile-1.3.1.min.js"></script>
	<script src="../demos/js/jquery.prettydate.js"></script>	
	<style>
		.ui-listview li .dateinfo{margin-left:15px;font-size:12px;float:right}
		.ui-listview li .dateinfo i{color:#999;}
		.corpItem span{color:gray; float:right;font-size:14px;}
		#sum b{color:#fff3a5;}
	</style>
	
	<script>
		var DETAIL_PAGE = "t3-info1.htm";//明细页
		var PARAM_NAME = "id";//参数名
		var builder;
		/*
		列表项生成器
		By takeashower
		*/
		ItemBuilder = {
			t :null,//模板项
			c:null ,//容器
			b:"" ,	//链接主干
			rows:0,
			//初始化生成器（模板、添加的容器、链接主干），清除已行
			init: function(templateItem, container, baseTarget){
				t = $(templateItem).hide();//模板项
				c = $(container);	//容器
				b = baseTarget;	//链接主干 
				this.reset();
				return this;
			},
			reset:function(){
				$(".gen").remove();
				rows =0;
			},
			//添加新项	
			addItem: function (id, name){
				var newItem = t.clone();
				newItem.find("b").text(name);
				newItem.find("code").text(id);
				newItem.find("a").attr("href",b + id);
				newItem.addClass("gen").removeClass("tempItem").removeAttr("style");//important! or the [style=display:block] will be clone.
				c.append(newItem);
				rows++;
			},
			//隐藏模板、刷新列表（如果添加多项，只刷新一次）
			done: function(){
				$('input[data-type="search"]').val("");
				$('input[data-type="search"]').trigger("change");//todo: why can't trigger change??
				c.listview("refresh");
				c.find("#sum").html("共&nbsp;<b>"+rows+"</b>&nbsp;条记录");
				//todo ...日期。。。
				var d = new Date()
				//d.setYear(2012);
				c.find("#timestamp").text( $.prettyDate.format(d.toISOString()) );
			}
			
			
			/**/
			
		}
		
		$(document).ready(function(){
			
			builder = ItemBuilder.init(".tempItem","#corplist", DETAIL_PAGE + "?"+ PARAM_NAME +"=");
			
			for(var i=0; i<20; i++){
				builder.addItem(i, "测试企业");
			}
			builder.done();

			$("#connect").click(function(){
				var kw= $('input[data-type="search"]').val();				
				
				$.ajax({url: "sample-queryRet.json",					
					dataType:"json",
					data:{"kw":kw},
					success:function(data){
						builder.reset();
						$.each(data,function(i, entry){
							builder.addItem(entry.nsrbm,entry.nsrMc);
						});
						builder.done();
					},
					error: function(XMLHttpRequest, textStatus, errorThrown){ 
	            alert('error:'+errorThrown); 
	        }
				}); 
			//- ajax
			
			//$("#connect").click();
			});					
		});
		
		//仅仅试一下...
		slice = Array.prototype.slice;
		function template(source, params) {
			if (arguments.length === 1) {
				return function () {
					var args = slice.call(arguments);
					args.unshift(source);
					return apply(this, args);
				};
			}
			// Detect different call patterns:
			// * template(source, [1, 2, 3])
			// * template(source, 1, 2, 3)
			if (!$.isArray(params)) {
				params = slice.call(arguments, 1);
			}
			$.each(params, function (i, n) {
				source = source.replace(new RegExp('\\{' + i + '\\}', 'g'), n);
			});
			return source;
		}
		//alert(template("pos1: {0} pos2: {1} pos3:{2}",["AA","BB",3]));
		//alert(template("{0}..{1}....", "num1", "num2"));
	</script>
</head>
<body>
<div data-role="page" data-theme="c" id="demo-page" class="my-page2">

	<div data-role="header">
		<a href="t1-welcome.htm?user=someone" data-role="button" data-icon="logo-taxm"  data-ajax="false">一户式查询</a>
		<h1>搜索</h1>

	<a id="connect" href="#" class="ui-btn-right" data-shadow="false" data-iconshadow="false" data-icon="grid" data-iconpos="right" data-ajax="false">联网搜索</a>
</div><!-- /header -->
	
	<div data-role="content">
 <ul id="corplist" data-role="listview" data-filter="true" data-filter-placeholder="请输入企业名称，或编号进行搜索..." data-inset="true" >
 	<li data-role="list-divider" ><label id="sum">&nbsp;</label><span class="dateinfo">数据更新：<span id="timestamp">2012-01-01 14:00</span></span></li>
 	<!--template item-->
	<li class="corpItem tempItem">	<a	href="t3-info1.htm" rel="external">	<b>未找到任何企业</b>		<span>	<label>	纳税人编号：</label>	<code>?</code></span></a></li>	 
	<!--/template item-->
	<li class="gen">fasdfsdf</li>

</ul>
                
    </div><!-- /content -->

<style>

   

</div><!-- /page -->
</body>
</html>
 